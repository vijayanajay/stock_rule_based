[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for INFY, skipping            
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.01s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for INFY, skipping            
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.02s                

Performance Summary:
Total Duration: 1.50s
Slowest Function: backtest_strategy
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Skipping data refresh (freeze mode).
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for INFY, skipping            
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-01-01.md 
* Report generated: reports\signals_2025-01-01.md
                      INFO     full_backtest completed in 0.02s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
Error: Invalid isoformat string for freeze_date: 'invalid-date'
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\kiss_signal.db        
                      INFO     Successfully created database at                
                               data\kiss_signal.db                             
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 13 symbols from universe                 
                      INFO     All symbols are fresh, no refresh needed        
                      INFO     Successfully refreshed 0/0 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 13 symbols from universe                 
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=5, initial_capital=100000.0          
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE:                       
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing INFY:                           
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TCS:                            
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing HDFCBANK:                       
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing ICICIBANK:                      
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing SBIN:                           
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing WIPRO:                          
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing HCLTECH:                        
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TECHM:                          
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing LTIM:                           
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing BHARTIARTL:                     
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing KOTAKBANK:                      
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing AXISBANK:                       
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 8 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.33s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Rules file not found: nonexistent.yaml
[2025-08-10 20:56:46] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Refreshing 1 symbols                            
[2025-08-10 20:56:47] INFO     Successfully refreshed 1/1 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      WARNING  Insufficient data for RELIANCE, skipping        
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.85s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:47] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:48] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                  Top Strategies by Edge Score                   
┌────────┬───────────────┬────────────┬───────┬────────┬────────┐
│ Symbol │ Rule Stack    │ Edge Score │ Win % │ Sharpe │ Trades │
├────────┼───────────────┼────────────┼───────┼────────┼────────┤
│ INFY   │ test_baseline │      0.600 │ 60.0% │   1.50 │     10 │
│ INFY   │ test_baseline │      0.600 │ 60.0% │   1.50 │     10 │
└────────┴───────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 2 valid strategies across 1 symbols.
[5/5] Saving results...
                      INFO     Saved 2 strategies to the database.             
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 2 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added new OPEN position for INFY at 101.        
                      INFO     Added new OPEN position for INFY at 101.        
                      INFO     Added 2 new positions                           
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.82s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
✅ Strategy performance analysis saved to: strategy_performance_report.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
An unexpected error occurred during clearing and recalculation: Clear failed
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:48] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
                      INFO     Loaded 1 symbols from universe                  
                      INFO     Refreshing 1 symbols                            
                      DEBUG    Fetching RELIANCE (1/1)                         
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['RELIANCE.NS', 1, 0])                      
                      DEBUG      Entering history()                            
                      DEBUG    RELIANCE.NS: Yahoo GET parameters: {'period1':  
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    RELIANCE.NS: yfinance received OHLC data:       
                               2024-08-12 03:45:00 -> 2025-08-08 03:45:00      
                      DEBUG    RELIANCE.NS: OHLC after cleaning: 2024-08-12    
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    RELIANCE.NS: OHLC after combining events:       
                               2024-08-12 00:00:00+05:30 -> 2025-08-08         
                               00:00:00+05:30                                  
                      DEBUG    RELIANCE.NS: yfinance returning OHLC: 2024-08-12
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to cache\RELIANCE.NS.csv            
                      INFO     Successfully refreshed 1/1 symbols              
                      INFO     full_backtest completed in 0.08s                
An unexpected error occurred during run pipeline: Generic backtest error
┌───────────────────── Traceback (most recent call last) ─────────────────────┐
│ D:\Code\stock_rule_based\src\kiss_signal\cli.py:469 in                      │
│ _execute_full_pipeline                                                      │
│                                                                             │
│   466 │   │   │   │   │   freeze_date=app_config.freeze_date,               │
│   467 │   │   │   │   )                                                     │
│   468 │   │   │                                                             │
│ > 469 │   │   │   all_results = _execute_backtesting_workflow(app_config, r │
│   470 │   │   │   console.print("[4/4] Analysis complete. Results summary:" │
│   471 │   │   │   _process_and_save_results(db_connection, all_results, app │
│   472                                                                       │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1139 in __call__                                                            │
│                                                                             │
│   1136 │   │   # in the signature                                           │
│   1137 │   │   self._mock_check_sig(*args, **kwargs)                        │
│   1138 │   │   self._increment_mock_call(*args, **kwargs)                   │
│ > 1139 │   │   return self._mock_call(*args, **kwargs)                      │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1143 in _mock_call                                                          │
│                                                                             │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│ > 1143 │   │   return self._execute_mock_call(*args, **kwargs)              │
│   1144 │                                                                    │
│   1145 │   def _increment_mock_call(self, /, *args, **kwargs):              │
│   1146 │   │   self.called = True                                           │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1198 in _execute_mock_call                                                  │
│                                                                             │
│   1195 │   │   effect = self.side_effect                                    │
│   1196 │   │   if effect is not None:                                       │
│   1197 │   │   │   if _is_exception(effect):                                │
│ > 1198 │   │   │   │   raise effect                                         │
│   1199 │   │   │   elif not _callable(effect):                              │
│   1200 │   │   │   │   result = next(effect)                                │
│   1201 │   │   │   │   if _is_exception(result):                            │
└─────────────────────────────────────────────────────────────────────────────┘
Exception: Generic backtest error
[2025-08-10 20:56:49] INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:49] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 1 symbols from universe                  
                      INFO     Refreshing 1 symbols                            
                      INFO     Successfully refreshed 1/1 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 1 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                  Top Strategies by Edge Score                  
┌──────────┬────────────┬────────────┬───────┬────────┬────────┐
│ Symbol   │ Rule Stack │ Edge Score │ Win % │ Sharpe │ Trades │
├──────────┼────────────┼────────────┼───────┼────────┼────────┤
│ RELIANCE │ test_rule  │      0.600 │ 75.0% │   1.20 │     15 │
└──────────┴────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 1 valid strategies across 1 symbols.
[5/5] Saving results...
                      INFO     Saving 1 strategies to the database.            
                      ERROR    Batch save failed: 'avg_return'                 
⚠️  Failed to save results to database.
                      WARNING  Persistence failed but continuing execution.    
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
[2025-08-10 20:56:50] INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 1 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added new OPEN position for RELIANCE at 2500.0. 
                      INFO     Added 1 new positions                           
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.30s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 3 symbols from universe                  
                      ERROR    Invalid entry_price (0.0) for position UNKNOWN  
                      INFO     Skipping new signal for EXISTING - position     
                               already open                                    
                      INFO     Identified 1 new signals (filtered 1 existing   
                               positions)                                      
                      INFO     Position TEST marked for closure: Stop-loss     
                               triggered at 94.00 (target: 97.00) -            
                               stop_loss_pct                                   
                      INFO     Position HOLD marked for closure: End of 20-day 
                               holding period                                  
                      INFO     Closed 1 positions                              
                      INFO     Identified 1 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added 1 new positions                           
[2025-08-10 20:56:50] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Refreshing 2 symbols                            
                      INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for INFY, skipping            
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.62s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:50] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:51] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      ERROR    Error analyzing RELIANCE: Data fetch failed     
                      ERROR    Error analyzing INFY: Data fetch failed         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      WARNING  Could not load NIFTY data for benchmark: Data   
                               fetch failed                                    
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.64s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.06s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      ERROR    Failed to generate report: Permission denied    
                               Traceback (most recent call last):              
                                 File                                          
                               "D:\Code\stock_rule_based\src\kiss_signal\report
                               er.py", line 478, in generate_daily_report      
                                   report_file.write_text(report_content,      
                               encoding="utf-8")                               
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1139, in     
                               __call__                                        
                                   return self._mock_call(*args, **kwargs)     
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1143, in     
                               _mock_call                                      
                                   return self._execute_mock_call(*args,       
                               **kwargs)                                       
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^                                             
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1198, in     
                               _execute_mock_call                              
                                   raise effect                                
                               OSError: Permission denied                      
(WARN) Report generation failed
                      INFO     full_backtest completed in 0.02s                
                      INFO     Database connection closed.                     
                      ERROR    Critical error: Could not save log file to      
                               run_log.txt. Reason: Permission denied          
                               Traceback (most recent call last):              
                                 File                                          
                               "D:\Code\stock_rule_based\src\kiss_signal\cli.py
                               ", line 351, in _save_command_log               
                                   log_path.write_text(console.export_text(clea
                               r=False), encoding="utf-8")                     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1139, in     
                               __call__                                        
                                   return self._mock_call(*args, **kwargs)     
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1143, in     
                               _mock_call                                      
                                   return self._execute_mock_call(*args,       
                               **kwargs)                                       
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^                                             
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1198, in     
                               _execute_mock_call                              
                                   raise effect                                
                                 File                                          
                               "D:\Code\stock_rule_based\src\kiss_signal\report
                               er.py", line 478, in generate_daily_report      
                                   report_file.write_text(report_content,      
                               encoding="utf-8")                               
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1139, in     
                               __call__                                        
                                   return self._mock_call(*args, **kwargs)     
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1143, in     
                               _mock_call                                      
                                   return self._execute_mock_call(*args,       
                               **kwargs)                                       
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^                                             
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1198, in     
                               _execute_mock_call                              
                                   raise effect                                
                               OSError: Permission denied                      
Critical error: Could not save log file to run_log.txt. Reason: Permission 
denied
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: [Errno 2] No such file or directory: 
'C:\\Users\\user\\AppData\\Local\\Temp\\pytest-of-user\\pytest-1193\\test_run_c
ommand_basic1\\nonexistent.yaml'
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.02s                

Performance Summary:
Total Duration: 0.02s
Slowest Function: full_backtest
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.02s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:51] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
[2025-08-10 20:56:52] INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['^NSEI', 1, 0])                            
                      DEBUG      Entering history()                            
                      DEBUG    ^NSEI: Yahoo GET parameters: {'period1':        
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    ^NSEI: yfinance received OHLC data: 2024-08-12  
                               03:45:00 -> 2025-08-08 03:45:00                 
                      DEBUG    ^NSEI: OHLC after cleaning: 2024-08-12          
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    ^NSEI: OHLC after combining events: 2024-08-12  
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG    ^NSEI: yfinance returning OHLC: 2024-08-12      
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\INDEX_NSEI.csv        
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.07s                

Performance Summary:
Total Duration: 0.07s
Slowest Function: full_backtest
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:52] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      INFO     full_backtest completed in 0.00s                
An unexpected error occurred during run pipeline: Report error
┌───────────────────── Traceback (most recent call last) ─────────────────────┐
│ D:\Code\stock_rule_based\src\kiss_signal\cli.py:469 in                      │
│ _execute_full_pipeline                                                      │
│                                                                             │
│   466 │   │   │   │   │   freeze_date=app_config.freeze_date,               │
│   467 │   │   │   │   )                                                     │
│   468 │   │   │                                                             │
│ > 469 │   │   │   all_results = _execute_backtesting_workflow(app_config, r │
│   470 │   │   │   console.print("[4/4] Analysis complete. Results summary:" │
│   471 │   │   │   _process_and_save_results(db_connection, all_results, app │
│   472                                                                       │
│                                                                             │
│ D:\Code\stock_rule_based\src\kiss_signal\cli.py:396 in                      │
│ _execute_backtesting_workflow                                               │
│                                                                             │
│   393 │   console.print("[3/4] Analyzing strategies for each ticker...")    │
│   394 │   symbols = data.load_universe(app_config.universe_path)            │
│   395 │   threshold = min_trades if min_trades is not None else getattr(app │
│ > 396 │   return _run_backtests(app_config, rules_config, symbols, freeze_d │
│   397                                                                       │
│   398                                                                       │
│   399 def _execute_full_pipeline(                                           │
│                                                                             │
│ D:\Code\stock_rule_based\src\kiss_signal\cli.py:196 in _run_backtests       │
│                                                                             │
│   193 │   # Use provided threshold, or fall back to config, or default to 0 │
│   194 │   threshold = min_trades_threshold if min_trades_threshold is not N │
│   195 │                                                                     │
│ > 196 │   bt = backtester.Backtester(                                       │
│   197 │   │   hold_period=getattr(app_config, "hold_period", 20),           │
│   198 │   │   min_trades_threshold=threshold,                               │
│   199 │   │   initial_capital=getattr(app_config, "portfolio_initial_capita │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1139 in __call__                                                            │
│                                                                             │
│   1136 │   │   # in the signature                                           │
│   1137 │   │   self._mock_check_sig(*args, **kwargs)                        │
│   1138 │   │   self._increment_mock_call(*args, **kwargs)                   │
│ > 1139 │   │   return self._mock_call(*args, **kwargs)                      │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1143 in _mock_call                                                          │
│                                                                             │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│ > 1143 │   │   return self._execute_mock_call(*args, **kwargs)              │
│   1144 │                                                                    │
│   1145 │   def _increment_mock_call(self, /, *args, **kwargs):              │
│   1146 │   │   self.called = True                                           │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1198 in _execute_mock_call                                                  │
│                                                                             │
│   1195 │   │   effect = self.side_effect                                    │
│   1196 │   │   if effect is not None:                                       │
│   1197 │   │   │   if _is_exception(effect):                                │
│ > 1198 │   │   │   │   raise effect                                         │
│   1199 │   │   │   elif not _callable(effect):                              │
│   1200 │   │   │   │   result = next(effect)                                │
│   1201 │   │   │   │   if _is_exception(result):                            │
└─────────────────────────────────────────────────────────────────────────────┘
Exception: Report error
[2025-08-10 20:56:53] INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md

Performance Summary:
Total Duration: 1.23s
Slowest Function: test_function
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Skipping data refresh (freeze mode).
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      WARNING  Could not load NIFTY data for benchmark: Cached 
                               data not found for ^NSEI (freeze mode)          
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-01-01.md 
* Report generated: reports\signals_2025-01-01.md
                      INFO     full_backtest completed in 0.02s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
Error: Invalid isoformat string for freeze_date: 'invalid-date'
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: [Errno 2] No such file or directory: 'config.yaml'
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Rules file not found: 
C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-1193\test_run_command_mi
ssing_rules1\config\missing_rules.yaml
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Config file not found
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Invalid config format
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.07s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:53] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:54] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                      Top Strategies by Edge Score                       
┌──────────┬─────────────────────┬────────────┬───────┬────────┬────────┐
│ Symbol   │ Rule Stack          │ Edge Score │ Win % │ Sharpe │ Trades │
├──────────┼─────────────────────┼────────────┼───────┼────────┼────────┤
│ RELIANCE │ sma_10_20_crossover │      0.750 │ 65.0% │   1.20 │     15 │
└──────────┴─────────────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 1 valid strategies across 1 symbols.
[5/5] Saving results...
                      INFO     Saving 1 strategies to the database.            
                      INFO     Successfully saved 1 strategies                 
                      INFO     Saved 1 strategies to the database.             
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 1 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added new OPEN position for RELIANCE at 0.0.    
                      INFO     Added 1 new positions                           
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.90s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:54] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
An unexpected error occurred during run pipeline: Database error
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:54] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
An unexpected error occurred during run pipeline: Unexpected database failure
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:54] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:55] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                 Top Strategies by Edge Score                 
┌────────┬────────────┬────────────┬───────┬────────┬────────┐
│ Symbol │ Rule Stack │ Edge Score │ Win % │ Sharpe │ Trades │
├────────┼────────────┼────────────┼───────┼────────┼────────┤
└────────┴────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 0 valid strategies across 0 symbols.
[5/5] Saving results...
⚠️  Database error: Save failed
                      ERROR    Persistence error: Save failed                  
                               Traceback (most recent call last):              
                                 File                                          
                               "D:\Code\stock_rule_based\src\kiss_signal\cli.py
                               ", line 303, in _save_results                   
                                   success = persistence.save_strategies_batch(
                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1139, in     
                               __call__                                        
                                   return self._mock_call(*args, **kwargs)     
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1143, in     
                               _mock_call                                      
                                   return self._execute_mock_call(*args,       
                               **kwargs)                                       
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^                                             
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\unittest\mock.py", line 1198, in     
                               _execute_mock_call                              
                                   raise effect                                
                               Exception: Save failed                          
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 0 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.71s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     All symbols are fresh, no refresh needed        
                      INFO     Successfully refreshed 0/0 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                 Top Strategies by Edge Score                 
┌────────┬────────────┬────────────┬───────┬────────┬────────┐
│ Symbol │ Rule Stack │ Edge Score │ Win % │ Sharpe │ Trades │
├────────┼────────────┼────────────┼───────┼────────┼────────┤
└────────┴────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 0 valid strategies across 0 symbols.
[5/5] Saving results...
⚠️  Failed to save results to database.
                      WARNING  Persistence failed but continuing execution.    
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 0 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.04s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
✅ Strategy performance analysis saved to: strategy_performance_report.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
✅ Strategy performance analysis saved to: strategy_performance_report.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
✅ Strategy performance analysis saved to: strategy_performance_report.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
✅ Strategy performance analysis saved to: 
C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-1193\test_analyze_strate
gies_comman4\custom_output.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
                      INFO     Creating database at                            
                               C:\Users\user\AppData\Local\Temp\pytest-of-user\
                               pytest-1193\test_analyze_strategies_comman5\data
                               \test.db                                        
                      INFO     Successfully created database at                
                               C:\Users\user\AppData\Local\Temp\pytest-of-user\
                               pytest-1193\test_analyze_strategies_comman5\data
                               \test.db                                        
                      INFO     Saving 1 strategies to the database.            
                      INFO     Successfully saved 1 strategies                 
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
Error: Cannot write to output path: Z:\nonexistent\drive\output.csv
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
                      ERROR    Failed to read strategies from database: no such
                               column: symbol                                  
No strategy data found.
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
An unexpected error occurred during analysis: Analysis failed
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:56:55] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
✅ Cleared: 5 strategies
✅ Preserved: 10 historical strategies
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:56] INFO     Successfully refreshed 2/2 symbols              
[4/4] Analysis complete. Results summary:
✅ New strategies found: 1
                      INFO     full_backtest completed in 0.62s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
An unexpected error occurred during clearing and recalculation: Database 
connection failed
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Invalid YAML in config file: 
C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-1193\test_clear_and_reca
lculate_bas1\invalid_config.yaml
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
Current database contains 0 strategies
Will preserve 0 historical strategies
Will clear 0 current strategy records
Operation cancelled.
An unexpected error occurred during clearing and recalculation: 0
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
Current database contains 0 strategies
Will preserve 0 historical strategies
Will clear 0 current strategy records
An unexpected error occurred during clearing and recalculation: 
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
An unexpected error occurred during clearing and recalculation: Database 
connection failed
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:56] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:57] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE.NS:                    
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TCS.NS:                         
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
✅ New strategies found: 0
                      INFO     full_backtest completed in 0.69s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:56:57] INFO     === KISS Signal CLI Run Started ===             
[2025-08-10 20:56:57] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:56:58] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                  Top Strategies by Edge Score                  
┌──────────┬────────────┬────────────┬───────┬────────┬────────┐
│ Symbol   │ Rule Stack │ Edge Score │ Win % │ Sharpe │ Trades │
├──────────┼────────────┼────────────┼───────┼────────┼────────┤
│ TCS      │ test       │      0.800 │ 70.0% │   1.50 │     10 │
│ RELIANCE │ test       │      0.750 │ 65.0% │   1.20 │      3 │
└──────────┴────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 2 valid strategies across 2 symbols.
[5/5] Saving results...
                      INFO     Saving 2 strategies to the database.            
                      INFO     Successfully saved 2 strategies                 
                      INFO     Saved 2 strategies to the database.             
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 2 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added new OPEN position for RELIANCE at 0.0.    
                      INFO     Added new OPEN position for TCS at 0.0.         
                      INFO     Added 2 new positions                           
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.77s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:58] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Invalid configuration in config.yaml: 9 validation
errors for Config
universe_path
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
historical_data_years
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
cache_dir
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
hold_period
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
min_trades_threshold
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
edge_score_weights
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
database_path
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
reports_output_dir
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
edge_score_threshold
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
[2025-08-10 20:56:58] INFO     === KISS Signal CLI Run Started ===             
Error loading configuration: Invalid configuration in config.yaml: 9 validation
errors for Config
universe_path
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
historical_data_years
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
cache_dir
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
hold_period
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
min_trades_threshold
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
edge_score_weights
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
database_path
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
reports_output_dir
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
edge_score_threshold
  Field required 
    For further information visit https://errors.pydantic.dev/2.11/v/missing
[2025-08-10 20:56:58] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at test.db                    
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at test.db        
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
                      INFO     Loaded 1 symbols from universe                  
                      INFO     Refreshing 1 symbols                            
                      DEBUG    Fetching RELIANCE (1/1)                         
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['RELIANCE.NS', 1, 0])                      
                      DEBUG      Entering history()                            
                      DEBUG    RELIANCE.NS: Yahoo GET parameters: {'period1':  
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    RELIANCE.NS: yfinance received OHLC data:       
                               2024-08-12 03:45:00 -> 2025-08-08 03:45:00      
                      DEBUG    RELIANCE.NS: OHLC after cleaning: 2024-08-12    
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    RELIANCE.NS: OHLC after combining events:       
                               2024-08-12 00:00:00+05:30 -> 2025-08-08         
                               00:00:00+05:30                                  
                      DEBUG    RELIANCE.NS: yfinance returning OHLC: 2024-08-12
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to cache\RELIANCE.NS.csv            
                      INFO     Successfully refreshed 1/1 symbols              
                      INFO     full_backtest completed in 0.09s                
An unexpected error occurred during run pipeline: Generic backtest error
┌───────────────────── Traceback (most recent call last) ─────────────────────┐
│ D:\Code\stock_rule_based\src\kiss_signal\cli.py:469 in                      │
│ _execute_full_pipeline                                                      │
│                                                                             │
│   466 │   │   │   │   │   freeze_date=app_config.freeze_date,               │
│   467 │   │   │   │   )                                                     │
│   468 │   │   │                                                             │
│ > 469 │   │   │   all_results = _execute_backtesting_workflow(app_config, r │
│   470 │   │   │   console.print("[4/4] Analysis complete. Results summary:" │
│   471 │   │   │   _process_and_save_results(db_connection, all_results, app │
│   472                                                                       │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1139 in __call__                                                            │
│                                                                             │
│   1136 │   │   # in the signature                                           │
│   1137 │   │   self._mock_check_sig(*args, **kwargs)                        │
│   1138 │   │   self._increment_mock_call(*args, **kwargs)                   │
│ > 1139 │   │   return self._mock_call(*args, **kwargs)                      │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1143 in _mock_call                                                          │
│                                                                             │
│   1140 │                                                                    │
│   1141 │                                                                    │
│   1142 │   def _mock_call(self, /, *args, **kwargs):                        │
│ > 1143 │   │   return self._execute_mock_call(*args, **kwargs)              │
│   1144 │                                                                    │
│   1145 │   def _increment_mock_call(self, /, *args, **kwargs):              │
│   1146 │   │   self.called = True                                           │
│                                                                             │
│ C:\Users\user\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py: │
│ 1198 in _execute_mock_call                                                  │
│                                                                             │
│   1195 │   │   effect = self.side_effect                                    │
│   1196 │   │   if effect is not None:                                       │
│   1197 │   │   │   if _is_exception(effect):                                │
│ > 1198 │   │   │   │   raise effect                                         │
│   1199 │   │   │   elif not _callable(effect):                              │
│   1200 │   │   │   │   result = next(effect)                                │
│   1201 │   │   │   │   if _is_exception(result):                            │
└─────────────────────────────────────────────────────────────────────────────┘
Exception: Generic backtest error
[2025-08-10 20:56:59] INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:59] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
                      DEBUG    Fetching RELIANCE.NS (1/2)                      
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['RELIANCE.NS', 1, 0])                      
                      DEBUG      Entering history()                            
                      DEBUG    RELIANCE.NS: Yahoo GET parameters: {'period1':  
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    RELIANCE.NS: yfinance received OHLC data:       
                               2024-08-12 03:45:00 -> 2025-08-08 03:45:00      
                      DEBUG    RELIANCE.NS: OHLC after cleaning: 2024-08-12    
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    RELIANCE.NS: OHLC after combining events:       
                               2024-08-12 00:00:00+05:30 -> 2025-08-08         
                               00:00:00+05:30                                  
                      DEBUG    RELIANCE.NS: yfinance returning OHLC: 2024-08-12
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\RELIANCE.NS.NS.csv    
                      DEBUG    Fetching TCS.NS (2/2)                           
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['TCS.NS', 1, 0])                           
                      DEBUG      Entering history()                            
                      DEBUG    TCS.NS: Yahoo GET parameters: {'period1':       
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    TCS.NS: yfinance received OHLC data: 2024-08-12 
                               03:45:00 -> 2025-08-08 03:45:00                 
                      DEBUG    TCS.NS: OHLC after cleaning: 2024-08-12         
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    TCS.NS: OHLC after combining events: 2024-08-12 
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG    TCS.NS: yfinance returning OHLC: 2024-08-12     
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\TCS.NS.NS.csv         
                      INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
[4/4] Analysis complete. Results summary:
In-Sample Results (NOT reliable for live trading)
                 Top Strategies by Edge Score                 
┌────────┬────────────┬────────────┬───────┬────────┬────────┐
│ Symbol │ Rule Stack │ Edge Score │ Win % │ Sharpe │ Trades │
├────────┼────────────┼────────────┼───────┼────────┼────────┤
│ TEST   │ test       │      0.750 │ 65.0% │   1.20 │     10 │
└────────┴────────────┴────────────┴───────┴────────┴────────┘

* Analysis complete. Found 1 valid strategies across 1 symbols.
[5/5] Saving results...
                      INFO     Saving 1 strategies to the database.            
                      DEBUG    Started transaction for batch save              
                      DEBUG    Strategy TEST total_trades: type=<class 'int'>, 
                               value=10                                        
                      DEBUG    Inserting total_trades as: 10 (type: <class     
                               'int'>)                                         
                      INFO     Successfully saved 1 strategies                 
                      INFO     Saved 1 strategies to the database.             
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['^NSEI', 1, 0])                            
                      DEBUG      Entering history()                            
                      DEBUG    ^NSEI: Yahoo GET parameters: {'period1':        
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    ^NSEI: yfinance received OHLC data: 2024-08-12  
                               03:45:00 -> 2025-08-08 03:45:00                 
                      DEBUG    ^NSEI: OHLC after cleaning: 2024-08-12          
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    ^NSEI: OHLC after combining events: 2024-08-12  
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG    ^NSEI: yfinance returning OHLC: 2024-08-12      
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\INDEX_NSEI.csv        
                      INFO     Fetched 0 open positions.                       
                      INFO     Fetched 0 open positions.                       
                      INFO     Identified 1 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added new OPEN position for TEST at 0.0.        
                      INFO     Added 1 new positions                           
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.76s                

Performance Summary:
Total Duration: 0.76s
Slowest Function: full_backtest
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:56:59] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
[2025-08-10 20:57:00] INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
                      INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE.NS:                    
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TCS.NS:                         
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.73s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:57:00] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      DEBUG    Enabled WAL mode for concurrent access          
                      DEBUG    Created strategies table                        
                      DEBUG    Created positions table                         
                      DEBUG    Created index on strategies table               
                      DEBUG    Created index on positions table                
                      DEBUG    Set database version to 2                       
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
                      INFO     Refreshing market data                          
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
                      DEBUG    Fetching RELIANCE.NS (1/2)                      
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['RELIANCE.NS', 1, 0])                      
                      DEBUG      Entering history()                            
                      DEBUG    RELIANCE.NS: Yahoo GET parameters: {'period1':  
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    RELIANCE.NS: yfinance received OHLC data:       
                               2024-08-12 03:45:00 -> 2025-08-08 03:45:00      
                      DEBUG    RELIANCE.NS: OHLC after cleaning: 2024-08-12    
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    RELIANCE.NS: OHLC after combining events:       
                               2024-08-12 00:00:00+05:30 -> 2025-08-08         
                               00:00:00+05:30                                  
                      DEBUG    RELIANCE.NS: yfinance returning OHLC: 2024-08-12
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\RELIANCE.NS.NS.csv    
[2025-08-10 20:57:01] DEBUG    Fetching TCS.NS (2/2)                           
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['TCS.NS', 1, 0])                           
                      DEBUG      Entering history()                            
                      DEBUG    TCS.NS: Yahoo GET parameters: {'period1':       
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    TCS.NS: yfinance received OHLC data: 2024-08-12 
                               03:45:00 -> 2025-08-08 03:45:00                 
                      DEBUG    TCS.NS: OHLC after cleaning: 2024-08-12         
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    TCS.NS: OHLC after combining events: 2024-08-12 
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG    TCS.NS: yfinance returning OHLC: 2024-08-12     
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\TCS.NS.NS.csv         
                      INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE.NS:                    
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TCS.NS:                         
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      DEBUG    Entering download()                             
                      DEBUG    Disabling multithreading because DEBUG logging  
                               enabled                                         
                      DEBUG     Entering history()                             
                      DEBUG    ('SELECT "t1"."key", "t1"."value" FROM "_tz_kv" 
                               AS "t1" WHERE ("t1"."key" = ?) LIMIT ? OFFSET   
                               ?', ['^NSEI', 1, 0])                            
                      DEBUG      Entering history()                            
                      DEBUG    ^NSEI: Yahoo GET parameters: {'period1':        
                               '2024-08-10 00:00:00+05:30', 'period2':         
                               '2025-08-10 00:00:00+05:30', 'interval': '1d',  
                               'includePrePost': False, 'events':              
                               'div,splits,capitalGains'}                      
                      DEBUG    ^NSEI: yfinance received OHLC data: 2024-08-12  
                               03:45:00 -> 2025-08-08 03:45:00                 
                      DEBUG    ^NSEI: OHLC after cleaning: 2024-08-12          
                               09:15:00+05:30 -> 2025-08-08 09:15:00+05:30     
                      DEBUG    ^NSEI: OHLC after combining events: 2024-08-12  
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG    ^NSEI: yfinance returning OHLC: 2024-08-12      
                               00:00:00+05:30 -> 2025-08-08 00:00:00+05:30     
                      DEBUG      Exiting history()                             
                      DEBUG     Exiting history()                              
                      DEBUG    Exiting download()                              
                      DEBUG    Saved cache to data\cache\INDEX_NSEI.csv        
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.78s                

Performance Summary:
Total Duration: 0.78s
Slowest Function: full_backtest
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:57:01] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Skipping data refresh (freeze mode).
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      ERROR    Data file not found for RELIANCE.NS: Cached data
                               not found for RELIANCE.NS (freeze mode)         
                      ERROR    Data file not found for TCS.NS: Cached data not 
                               found for TCS.NS (freeze mode)                  
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      WARNING  Could not load NIFTY data for benchmark: Cached 
                               data not found for ^NSEI (freeze mode)          
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-01-01.md 
* Report generated: reports\signals_2025-01-01.md
                      INFO     full_backtest completed in 0.03s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:57:01] INFO     === KISS Signal CLI Run Started ===             
Error: Invalid isoformat string for freeze_date: 'invalid-date'
[2025-08-10 20:57:01] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:57:01] INFO     === KISS Signal CLI Run Started ===             
Analyzing per-stock strategy performance...
No historical strategies found to analyze.
                      INFO     Log file saved to analyze_strategies_log.txt    
[2025-08-10 20:57:01] INFO     === KISS Signal CLI Run Started ===             
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
✅ Cleared: 0 strategies
✅ Preserved: 0 historical strategies
[1/4] Configuration loaded.
[2/4] Refreshing market data...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Refreshing 2 symbols                            
[2025-08-10 20:57:02] INFO     Successfully refreshed 2/2 symbols              
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE.NS:                    
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing TCS.NS:                         
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Downloading fresh data for ^NSEI                
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
✅ New strategies found: 0
                      INFO     full_backtest completed in 0.70s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to clear_and_recalculate_log.txt 
[2025-08-10 20:57:02] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at data\test.db               
                      INFO     Successfully created database at data\test.db   
[1/4] Configuration loaded.
[2/4] Refreshing market data...
[3/4] Analyzing strategies for each ticker...
                      WARNING  Insufficient data for RELIANCE, skipping        
                      WARNING  Insufficient data for TCS, skipping             
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated: reports\signals_2025-08-10.md 
* Report generated: reports\signals_2025-08-10.md
                      INFO     full_backtest completed in 0.01s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
                      ERROR    Critical error: Could not save log file to      
                               C:\Users\user\AppData\Local\Temp\tmpuwosfdce\rea
                               donly.log. Reason: [Errno 13] Permission denied:
                               'C:\\Users\\user\\AppData\\Local\\Temp\\tmpuwosf
                               dce\\readonly.log'                              
                               Traceback (most recent call last):              
                                 File                                          
                               "D:\Code\stock_rule_based\src\kiss_signal\cli.py
                               ", line 351, in _save_command_log               
                                   log_path.write_text(console.export_text(clea
                               r=False), encoding="utf-8")                     
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\pathlib.py", line 1047, in write_text
                                   with self.open(mode='w', encoding=encoding, 
                               errors=errors, newline=newline) as f:           
                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                 
                                 File                                          
                               "C:\Users\user\AppData\Local\Programs\Python\Pyt
                               hon312\Lib\pathlib.py", line 1013, in open      
                                   return io.open(self, mode, buffering,       
                               encoding, errors, newline)                      
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                               ^^^^^^^^^^^^^^^^^^^^                            
                               PermissionError: [Errno 13] Permission denied:  
                               'C:\\Users\\user\\AppData\\Local\\Temp\\tmpuwosf
                               dce\\readonly.log'                              
Critical error: Could not save log file to 
C:\Users\user\AppData\Local\Temp\tmpuwosfdce\readonly.log. Reason: [Errno 13] 
Permission denied: 
'C:\\Users\\user\\AppData\\Local\\Temp\\tmpuwosfdce\\readonly.log'
                      INFO     Log file saved to                               
                               C:\Users\user\AppData\Local\Temp\tmp7kjhxs5e.log
                      WARNING  ATR stop loss check failed: ATR calculation     
                               failed                                          
                      WARNING  ATR take profit check failed: ATR calculation   
                               failed                                          
                      ERROR    Invalid entry_price (0.0) for position X        
                      INFO     Skipping new signal for HOLD - position already 
                               open                                            
                      INFO     Identified 1 new signals (filtered 1 existing   
                               positions)                                      
                      INFO     Position X marked for closure: Stop-loss        
                               triggered at 80.00 (target: 95.00) -            
                               stop_loss_pct                                   
                      INFO     Identified 1 new signals (filtered 0 existing   
                               positions)                                      
                      INFO     Added 1 new positions                           
                      INFO     Loaded 2 symbols from universe                  
[2025-08-10 20:57:02] INFO     === KISS Signal CLI Run Started ===             
┌───────────────────────────────── QuickEdge ─────────────────────────────────┐
│ KISS Signal CLI                                                             │
│ Keep-It-Simple Data Foundation                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                      INFO     Creating database at                            
                               C:\Users\user\AppData\Local\Temp\pytest-of-user\
                               pytest-1193\test_end_to_end_cli_workflow0\test_i
                               ntegration.db                                   
[2025-08-10 20:57:03] INFO     Successfully created database at                
                               C:\Users\user\AppData\Local\Temp\pytest-of-user\
                               pytest-1193\test_end_to_end_cli_workflow0\test_i
                               ntegration.db                                   
[1/4] Configuration loaded.
[2/4] Skipping data refresh (freeze mode).
[3/4] Analyzing strategies for each ticker...
                      INFO     Loaded 2 symbols from universe                  
                      INFO     Backtester initialized: hold_period=20,         
                               min_trades=10, initial_capital=100000.0         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing RELIANCE:                       
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
                      INFO     find_optimal_strategies completed in 0.00s      
                      ERROR    Error analyzing INFY:                           
                               Backtester.find_optimal_strategies() got an     
                               unexpected keyword argument 'in_sample'         
[4/4] Analysis complete. Results summary:
No valid strategies found. Check data quality and rule configurations.
[5/5] Generating report...
                      WARNING  Could not load NIFTY data for benchmark: Cached 
                               data not found for ^NSEI (freeze mode)          
                      INFO     Fetched 0 open positions.                       
                      INFO     Report generated:                               
                               C:\Users\user\AppData\Local\Temp\pytest-of-user\
                               pytest-1193\test_end_to_end_cli_workflow0\report
                               s\signals_2024-06-01.md                         
* Report generated: 
C:\Users\user\AppData\Local\Temp\pytest-of-user\pytest-1193\test_end_to_end_cli
_workflow0\reports\signals_2024-06-01.md
                      INFO     full_backtest completed in 0.05s                
                      INFO     Database connection closed.                     
                      INFO     Log file saved to run_log.txt                   
[2025-08-10 20:57:03] INFO     === KISS Signal CLI Run Started ===             
Analyzing aggregated strategy performance...
No strategy data found.
No historical strategies found to analyze.
