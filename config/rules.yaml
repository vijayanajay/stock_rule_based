# =============================================================================
# REVISED STRATEGY: EXTREME-Conviction Pullback in a Bull Market
#
# THESIS: The previous strategy was too loose. We will now ONLY buy a
# VIOLENT bullish reversal pattern during a short-term pullback, backed by
# OVERWHELMING evidence. We will be far more selective and take profits sooner.
# =============================================================================

# -----------------------------------------------------------------------------
# PRECONDITIONS: Stock personality filters (NEW in Story 023)
# Filter out stocks that lack the personality traits needed for trend-following
# strategies. Applied before expensive rule evaluation for performance.
# -----------------------------------------------------------------------------
preconditions:
  - name: "stock_in_long_term_uptrend"
    type: "price_above_long_sma"
    description: "Precondition 1: Stock must be above its 200-day SMA (simple long-term uptrend)."
    params:
      period: 200

  - name: "stock_is_sufficiently_volatile"
    type: "is_volatile"
    description: "Precondition 2: Stock must have daily volatility â‰¥2% (ATR/Price) for meaningful risk/reward."
    params:
      period: 14
      atr_threshold_pct: 0.02

# -----------------------------------------------------------------------------
# CONTEXT FILTERS: No change. This is sound. Don't trade against the market.
# -----------------------------------------------------------------------------
context_filters:
  - name: "filter_market_is_bullish"
    type: "market_above_sma"
    description: "Context 1: Don't fight the tape. The NIFTY 50 index must be above its 50-day SMA."
    params:
      index_symbol: "^NSEI"
      period: 50

# -----------------------------------------------------------------------------
# ENTRY SIGNALS: Make the entry signal EXTREMELY selective.
# All entry signals must be true for a buy signal (AND logic)
# -----------------------------------------------------------------------------
entry_signals:
  - name: "strong_bullish_engulfing"
    type: "engulfing_pattern"
    description: "Entry 1: Enter on an EXTREMELY strong bullish engulfing pattern. The body of the green candle must be at least 2.5x the prior red candle."
    params:
      min_body_ratio: 2.5  # TIGHTENED from 1.5. We only want explosive reversals.

  - name: "confirm_with_extreme_volume"
    type: "volume_spike"
    description: "Entry 2: The reversal must be backed by overwhelming volume (3x average)."
    params:
      period: 20
      spike_multiplier: 3.0  # TIGHTENED from 2.0. We need institutional conviction.
      price_change_threshold: 0.01

  - name: "confirm_with_medium_term_uptrend"
    type: "price_above_sma"
    description: "Entry 3: The stock itself must be in a medium-term uptrend (Price > 50-day SMA)."
    params:
      period: 50 # No change. This is a sound rule.

# -----------------------------------------------------------------------------
# EXIT CONDITIONS: Be more realistic.
# -----------------------------------------------------------------------------
exit_conditions:
  # --- Primary Risk Management ---
  - name: "atr_stop_loss_1.5x"
    type: "stop_loss_atr"
    description: "RISK 1 (Tighter Stop): Exit if price drops 1.5x ATR. The old 2x stop allowed too much loss."
    params:
      period: 14
      multiplier: 1.5 # TIGHTENED from 2.0. Cut losses faster.

  # --- Trend Failure Exit ---
  - name: "trend_reversal_exit"
    type: "sma_cross_under"
    description: "RISK 2 (Trend Failure): Exit if the short-term trend breaks (10d SMA < 20d SMA)."
    params:
      fast_period: 10
      slow_period: 20

  # --- Profit Target ---
  - name: "atr_take_profit_3x"
    type: "take_profit_atr"
    description: "PROFIT TARGET: Exit if price rises 3x ATR. This still ensures a 2:1 Reward/Risk ratio with our tighter stop."
    params:
      period: 14
      multiplier: 3.0 # REDUCED from 4.0. The data shows 4x is too ambitious. Let's bank profits sooner.